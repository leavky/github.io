<!DOCTYPE html>
<html lang="zh-CN">

  
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  <meta name="author" content="è‘£æ²…é‘«, yuanxin.me@gmail.com">
  
  
  
  <title>PHPæ–‡ä»¶åŒ…å«æ¼æ´å°ç»“ | Leavky</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="å®‰å…¨,WEBå®‰å…¨,æ–‡ä»¶åŒ…å«,PHPæ–‡ä»¶åŒ…å«,">
  

  <script>
    console.log('\n%c Hexo-theme-bmw v4.0 ' + '%c ğŸ‰ https://github.com/dongyuanxin/theme-bmw ğŸ‰\n' + '\n%c View demo online ' + '%c ğŸ” https://godbmw.com/ ğŸ”  \n' , 'color: #fadfa3; background: #030307; padding:3px 0;', '', 'color: #fadfa3; background: #030307; padding:3px 0;', '');
  </script>

  

  

  
    <link rel="icon" href="/images/favicon.ico">
    <link rel="apple-touch-icon" href="/images/touch-icon.png">
  

  <link href="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/leavky.github.io/css/base.css">
<link rel="stylesheet" href="/leavky.github.io/icon/iconfont.css">
<link rel="stylesheet" href="/leavky.github.io/css/github-markdown.css">
<link rel="stylesheet" href="/leavky.github.io/css/highlight.css">

  <script src="/leavky.github.io/js/util.js"></script>
<script src="/leavky.github.io/js/valine.min.js"></script>

  

  
    <link href="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/aplayer/1.10.1/APlayer.min.js" async></script>
  

  
    <link href="https://cdn.bootcss.com/social-share.js/1.0.16/css/share.min.css" rel="stylesheet">
  
  
  <script src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js" async></script>
  
  
    <script src="//cdn.jsdelivr.net/npm/leancloud-storage@3.11.0/dist/av-min.js"></script>
  

</head>

  <body>

    

    <div id="app">

      <div class="header-wrap">
  <header>
    <div class="site-brand">
      <div class="site-title">
        <a href="/leavky.github.io/">Leavky.com</a>
      </div>
    </div>
    <nav class="site-navigation">
      <ul class="nav-menu">
      
        <li class="nav-item" data-path="/">
          
            <a href="/leavky.github.io/" target="_self">
              ä¸»é¡µ
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/archives/">
          
            <a href="/leavky.github.io/archives/" target="_self">
              å½’æ¡£
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/categories/">
          
            <a href="/leavky.github.io/categories/" target="_self">
              åˆ†ç±»
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/tags/">
          
            <a href="/leavky.github.io/tags/" target="_self">
              æ ‡ç­¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/friends/">
          
            <a href="/leavky.github.io/friends/" target="_self">
              å‹é“¾
            </a>
          
        </li>
      
        <li class="nav-item" data-path="/about/">
          
            <a href="/leavky.github.io/about/" target="_self">
              å…³äº
            </a>
          
        </li>
      
      </ul>
    </nav>
    <i class="iconfont icon-menu"></i>
  </header>
</div>

<script>
  let links = document.querySelectorAll('.nav-item');
  for(let link of links){
    let childrenLink = link.querySelector('ul');
    link.addEventListener('mouseenter', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown active";
      }
    })
    link.addEventListener('mouseleave', () => {
      if(childrenLink) {
        childrenLink.className = "nav-menu--dropdown";
      }
    })
  }
  let rootRealPath = getRealPath(window.location.pathname, true);
  for(let link of links) {
    let linkPath = link.getAttribute("data-path");
    if(linkPath && getRealPath(linkPath, true) === rootRealPath) {
      link.className = "nav-item hover";
    }
  }

  let iconMenu = document.querySelector("i.iconfont.icon-menu"),
    iconMenuClicked = false;
  let navDOM = document.querySelector("nav.site-navigation");
  iconMenu.addEventListener("click", () => {
    iconMenuClicked 
      ? navDOM.className = "site-navigation active"
      : navDOM.className = "site-navigation";
    iconMenuClicked = !iconMenuClicked;
  })
</script>

      








<div class="container post-index">

  

<div class="post">
  <h1 class="article-title">
    <span>PHPæ–‡ä»¶åŒ…å«æ¼æ´å°ç»“</span>
  </h1>
  <div class="article-top-meta">
    <span>
      å‘å¸ƒ : 
      2019-01-16
    </span>
    
      <span>
        åˆ†ç±» : 
          <a href="/leavky.github.io/categories/å®‰å…¨/">
            å®‰å…¨
          </a>
      </span>
    
    
  </div>

  

  <div class="article-content">
    <div class="markdown-body">
      <h3 id="1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1 åŸºæœ¬æ¦‚å¿µ"></a>1 åŸºæœ¬æ¦‚å¿µ</h3><h4 id="1-1ç›¸å…³å‡½æ•°"><a href="#1-1ç›¸å…³å‡½æ•°" class="headerlink" title="1.1ç›¸å…³å‡½æ•°"></a>1.1ç›¸å…³å‡½æ•°</h4><p>phpä¸­å¼•å‘æ–‡ä»¶åŒ…å«æ¼æ´çš„å‡½æ•°é€šå¸¸æ˜¯ä»¥ä¸‹å››ä¸ªå‡½æ•°ï¼š</p>
<ol>
<li>include()</li>
<li>include_once()</li>
<li>require()</li>
<li>require_once()</li>
</ol>
<p><code>include()</code>åŒ…å«å¦‚æœå‡ºé”™ï¼Œå¦‚æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæå‡ºè­¦å‘Šç„¶åç»§ç»­æ‰§è¡Œã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/88399107.jpg" alt=""></p>
<p><code>require()</code>åŒ…å«æ–‡ä»¶å‡ºé”™ï¼Œç›´æ¥é€€å‡ºã€‚<br><img src="http://ozrtrbf6a.bkt.clouddn.com/18-2-3/17625323.jpg" alt=""></p>
<p><code>require_once()</code> å’Œ <code>include_once()</code>ä¸<code>require()</code>å’Œ<code>include()</code>åŠŸèƒ½ç›¸ä¼¼ï¼Œåªæ˜¯ä¸ºäº†é˜²æ­¢é‡å¤åŒ…å«ã€‚</p>
<p>å½“ä½¿ç”¨è¿™å‡ ä¸ªå‡½æ•°åŒ…å«æ–‡ä»¶æ—¶ï¼Œä¸ç®¡æ–‡ä»¶æ˜¯ä»€ä¹ˆç±»å‹ï¼Œéƒ½ä¼šè¢«è§£ææˆphpã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/91956916.jpg" alt=""></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/57317872.jpg" alt=""></p>
<h4 id="1-2-åœºæ™¯"><a href="#1-2-åœºæ™¯" class="headerlink" title="1.2 åœºæ™¯"></a>1.2 åœºæ™¯</h4><ol>
<li>å…·æœ‰ç›¸å…³çš„æ–‡ä»¶åŒ…å«å‡½æ•°ã€‚</li>
<li>æ–‡ä»¶åŒ…å«å‡½æ•°ä¸­å­˜åœ¨å˜é‡ï¼Œæ¯”å¦‚<code>include $file</code>ã€‚</li>
<li>æ”»å‡»è€…å¯ä»¥æ§åˆ¶å˜é‡ï¼Œæ¯”å¦‚<code>$file = $_GET[file]</code>ã€‚</li>
</ol>
<h4 id="1-3-åˆ†ç±»"><a href="#1-3-åˆ†ç±»" class="headerlink" title="1.3 åˆ†ç±»"></a>1.3 åˆ†ç±»</h4><h5 id="1-3-1-LFI-æœ¬åœ°æ–‡ä»¶åŒ…å«"><a href="#1-3-1-LFI-æœ¬åœ°æ–‡ä»¶åŒ…å«" class="headerlink" title="1.3.1 LFI(æœ¬åœ°æ–‡ä»¶åŒ…å«)"></a>1.3.1 LFI(æœ¬åœ°æ–‡ä»¶åŒ…å«)</h5><p>èƒ½å¤Ÿæ‰“å¼€å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶çš„æ¼æ´ã€‚</p>
<h5 id="1-3-2-RFI-è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#1-3-2-RFI-è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="1.3.2 RFI(è¿œç¨‹æ–‡ä»¶åŒ…å«)"></a>1.3.2 RFI(è¿œç¨‹æ–‡ä»¶åŒ…å«)</h5><p>èƒ½å¤ŸåŒ…å«è¿œç¨‹æœåŠ¡å™¨çš„æ–‡ä»¶å¹¶æ‰§è¡Œï¼Œå±å®³æ€§å¾ˆï¼Œä½†æ˜¯éœ€è¦åˆ©ç”¨æ¡ä»¶ã€‚</p>
<ol>
<li>allow_url_fopen = On</li>
<li>allow_url_include = On<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/8227977.jpg" alt=""></li>
</ol>
<p>æ³¨ï¼š<br>å½“åŒ…å«è¿œç¨‹æ–‡ä»¶ä¹Ÿæ˜¯phpæ—¶ï¼Œphpæ–‡ä»¶ä¼šåœ¨è¿œç¨‹æœåŠ¡å™¨æ‰§è¡Œã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/52729123.jpg" alt=""></p>
<p>åœ¨<code>php.ini</code>ä¸­ï¼Œ<code>allow_url_fopen</code>é»˜è®¤ä¸º<code>On</code>è€Œ<code>allow_url_include</code>åœ¨php5.2åé»˜è®¤ä¸º<code>Off</code>ã€‚</p>
<h3 id="2-åŒ…å«å§¿åŠ¿"><a href="#2-åŒ…å«å§¿åŠ¿" class="headerlink" title="2 åŒ…å«å§¿åŠ¿"></a>2 åŒ…å«å§¿åŠ¿</h3><p>æµ‹è¯•ä»£ç ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/24783798.jpg" alt=""></p>
<ol>
<li>allow_url_fopen = On</li>
<li>allow_url_include = Off</li>
</ol>
<h4 id="2-1-PHPä¼ªåè®®"><a href="#2-1-PHPä¼ªåè®®" class="headerlink" title="2.1 PHPä¼ªåè®®"></a>2.1 PHPä¼ªåè®®</h4><h5 id="2-1-1-php-input"><a href="#2-1-1-php-input" class="headerlink" title="2.1.1 php://input"></a>2.1.1 php://input</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>allow_url_include = On</li>
<li>å¯¹allow_url_fopenä¸åšè¦æ±‚ã€‚</li>
</ol>
<p>å§¿åŠ¿ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/96424286.jpg" alt=""></p>
<h5 id="2-1-2-php-filter"><a href="#2-1-2-php-filter" class="headerlink" title="2.1.2 php://filter"></a>2.1.2 php://filter</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š<br>æ— ç‰¹åˆ«è¦æ±‚ã€‚</p>
<p>å§¿åŠ¿ï¼š<br><code>http://localhost/test/FileInclude/index.php?file=php://filter/read=convert.base64-encode/resource=info.txt</code></p>
<p>å¯ä»¥è¯»å–base64åŠ å¯†åçš„æ–‡ä»¶æºç ã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/45495238.jpg" alt=""></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/84457506.jpg" alt=""></p>
<p>æ³¨ï¼š<br>å°‘äº†<code>read</code>å…³é”®å­—ã€‚<br><code>http://localhost/test/FileInclude/index.php?file=php://filter/convert.base64-encode/resource=info.txt</code></p>
<h5 id="2-1-3-phar"><a href="#2-1-3-phar" class="headerlink" title="2.1.3 phar://"></a>2.1.3 phar://</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>php &gt; 5.3.0</li>
</ol>
<p>å§¿åŠ¿ï¼š<br>å‡å¦‚æœ‰ä¸ªzipå‹ç¼©åŒ…ï¼Œå…¶ä¸­çš„æ–‡ä»¶ä¸º<code>info.txt</code><br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/35741195.jpg" alt=""><br>ç›¸å¯¹è·¯å¾„ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/36007480.jpg" alt=""><br>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚</p>
<h5 id="2-1-4-zip"><a href="#2-1-4-zip" class="headerlink" title="2.1.4 zip://"></a>2.1.4 zip://</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>php &gt;= 5.3.0</li>
</ol>
<p>å§¿åŠ¿ï¼š<br>ä¸pharç›¸åŒã€‚</p>
<p>ä½¿ç”¨zipåè®®ï¼Œéœ€è¦æŒ‡å®šç»å¯¹è·¯å¾„ã€‚åŒæ—¶å°†<code>#</code>ç¼–ç ä¸º<code>%23</code>ã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/24987303.jpg" alt=""><br>å¦‚æœæ—¶ç›¸å¯¹è·¯å¾„ï¼Œé‚£ä¹ˆåŒ…å«å¤±è´¥</p>
<h5 id="2-1-5-data-URL-schema"><a href="#2-1-5-data-URL-schema" class="headerlink" title="2.1.5 data:URL schema"></a>2.1.5 data:URL schema</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>php &gt;= 5.2</li>
<li>allow_url_fopen = On</li>
<li>allow_url_include = On</li>
</ol>
<p>å§¿åŠ¿ä¸€ï¼š<br><code>http://localhost/test/FileInclude/index.php?file=data://text/plain,&lt;?php phpinfo();?&gt;</code></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/39800264.jpg" alt=""></p>
<p>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š<br><code>http://localhost/test/FileInclude/index.php?file=data://text/plain,&lt;?php system(&#39;whoami&#39;);?&gt;</code></p>
<p>å§¿åŠ¿äºŒï¼š<br><code>http://localhost/test/FileInclude/index.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b</code></p>
<p><code>PD9waHAgcGhwaW5mbygpOz8+</code>çš„base64è§£ç ä¸º<code>&#39;&lt;?php phpinfo();?&gt;</code>,è€Œ<code>+</code>çš„urlç¼–ç ä¸º<code>%2b</code>ã€‚</p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/53343984.jpg" alt=""></p>
<p>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š<br><code>http://localhost/test/FileInclude/index.php?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCd3aG9hbWknKTs/Pg==</code></p>
<p>å…¶ä¸­<code>PD9waHAgc3lzdGVtKCd3aG9hbWknKTs/Pg==çš„base64</code>è§£ç ä¸ºï¼š<code>&lt;?php system(&#39;whoami&#39;);?&gt;</code></p>
<h4 id="2-2-åŒ…å«session"><a href="#2-2-åŒ…å«session" class="headerlink" title="2.2 åŒ…å«session"></a>2.2 åŒ…å«session</h4><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>sessionæ–‡ä»¶è·¯å¾„å·²çŸ¥ï¼Œä¸”å…¶ä¸­éƒ¨åˆ†å†…å®¹å¯æ§ã€‚</li>
</ol>
<p>å§¿åŠ¿ï¼š<br>phpçš„sessionæ–‡ä»¶ä¿å­˜è·¯å¾„å¯ä»¥åœ¨phpinfoçš„session.save_pathçœ‹åˆ°ã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/32157707.jpg" alt=""></p>
<p>å¸¸è§çš„php_sessionå­˜æ”¾ä½ç½®ï¼š</p>
<ol>
<li>/var/lib/php/sess_PHPSESSID</li>
<li>/tmp/sess_PHPSESSID</li>
<li>/tmp/sessions/sess_PHPSESSID</li>
</ol>
<p>sessionæ–‡ä»¶çš„å‘½åæ ¼å¼ä¸ºsess_[PHPSESSID]ã€‚<code>PHPSESSID</code>å¯ä»¥åœ¨å‘é€è¯·æ±‚çš„cookieä¸­æŸ¥åˆ°ã€‚</p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/52936551.jpg" alt=""></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/83030451.jpg" alt=""></p>
<p>è¦åŒ…å«å¹¶åˆ©ç”¨çš„è¯ï¼Œéœ€è¦èƒ½æ§åˆ¶éƒ¨åˆ†sesssionæ–‡ä»¶çš„å†…å®¹ã€‚æš‚æ—¶æ²¡æœ‰é€šç”¨çš„åŠæ³•ã€‚æœ‰äº›æ—¶å€™ï¼Œå¯ä»¥å…ˆåŒ…å«è¿›sessionæ–‡ä»¶ï¼Œè§‚å¯Ÿé‡Œé¢çš„å†…å®¹ï¼Œç„¶åæ ¹æ®é‡Œé¢çš„å­—æ®µæ¥å‘ç°å¯æ§çš„å˜é‡ï¼Œä»è€Œåˆ©ç”¨å˜é‡æ¥å†™å…¥payloadï¼Œå¹¶ä¹‹åå†æ¬¡åŒ…å«ä»è€Œæ‰§è¡Œphpä»£ç ã€‚</p>
<p>å‚è€ƒæ–‡ç« ï¼š</p>
<h4 id="2-3-åŒ…å«æ—¥å¿—"><a href="#2-3-åŒ…å«æ—¥å¿—" class="headerlink" title="2.3 åŒ…å«æ—¥å¿—"></a>2.3 åŒ…å«æ—¥å¿—</h4><h5 id="2-3-1-è®¿é—®æ—¥å¿—"><a href="#2-3-1-è®¿é—®æ—¥å¿—" class="headerlink" title="2.3.1 è®¿é—®æ—¥å¿—"></a>2.3.1 è®¿é—®æ—¥å¿—</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>çŸ¥é“æœåŠ¡å™¨æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œä¸”æ—¥å¿—æ–‡ä»¶å¯è¯»ã€‚</li>
</ol>
<p>å§¿åŠ¿ï¼š<br>å¾ˆå¤šæ—¶å€™ï¼ŒwebæœåŠ¡å™¨ä¼šå°†è¯·æ±‚å†™å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ¯”å¦‚è¯´apacheã€‚åœ¨ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šå°†è¯·æ±‚å†™å…¥access.logï¼Œå½“å‘ç”Ÿé”™è¯¯æ—¶å°†é”™è¯¯å†™å…¥error.logã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ä¿å­˜è·¯å¾„åœ¨ /var/log/apache2/ã€‚</p>
<p>ä½†å¦‚æœæ˜¯ç›´æ¥å‘èµ·è¯·æ±‚ï¼Œä¼šå¯¼è‡´ä¸€äº›ç¬¦å·è¢«ç¼–ç ä½¿å¾—åŒ…å«æ— æ³•æ­£ç¡®è§£æã€‚å¯ä»¥ä½¿ç”¨burpæˆªåŒ…åä¿®æ”¹ã€‚<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/87751522.jpg" alt=""></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/36456954.jpg" alt=""></p>
<p>åŒ…å«æ—¥å¿—åæ‰§è¡Œï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/8947299.jpg" alt=""></p>
<p>åœ¨ä¸€äº›åœºæ™¯ä¸­ï¼Œlogçš„åœ°å€æ˜¯è¢«ä¿®æ”¹æ‰çš„ã€‚ä½ å¯ä»¥é€šè¿‡è¯»å–ç›¸åº”çš„é…ç½®æ–‡ä»¶åï¼Œå†è¿›è¡ŒåŒ…å«ã€‚</p>
<h5 id="2-3-2-SSH-log"><a href="#2-3-2-SSH-log" class="headerlink" title="2.3.2 SSH log"></a>2.3.2 SSH log</h5><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>çŸ¥é“ssh-logçš„ä½ç½®ä¸”å¯è¯»ã€‚é»˜è®¤ä¸º<code>/var/log/auth.log</code></li>
</ol>
<p>å§¿åŠ¿ï¼š<br>ç”¨sshè¿œç¨‹è¿æ¥ï¼Œå¯†ç æ— æ‰€è°“ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/11811279.jpg" alt=""><br>ç„¶åå°±å¯ä»¥å†™å…¥phpä»£ç ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/93141661.jpg" alt=""><br>åˆ©ç”¨ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/44302123.jpg" alt=""></p>
<h4 id="2-4-åŒ…å«environ"><a href="#2-4-åŒ…å«environ" class="headerlink" title="2.4 åŒ…å«environ"></a>2.4 åŒ…å«environ</h4><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>phpä»¥cgiçš„æ–¹å¼è¿è¡Œï¼Œè¿™æ ·environæ‰ä¼šä¿æŒUAå¤´ã€‚</li>
<li>environæ–‡ä»¶å­˜å‚¨ä½ç½®å·²çŸ¥ï¼Œä¸”environæ–‡ä»¶å¯è¯»ã€‚</li>
</ol>
<p>å§¿åŠ¿ï¼š<br>proc/self/environä¸­ä¼šä¿å­˜user-agentå¤´ã€‚å¦‚æœåœ¨user-agentä¸­æ’å…¥phpä»£ç ï¼Œåˆ™phpä»£ç ä¼šè¢«å†™å…¥åˆ°environä¸­ã€‚ä¹‹åå†åŒ…å«å®ƒï¼Œå³å¯ã€‚</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://www.exploit-db.com/papers/12886/" target="_blank" rel="noopener">shell via LFI - proc/self/environ method</a></li>
<li><a href="http://websecuritylog.blogspot.jp/2010/06/procselfenviron-injection.html" target="_blank" rel="noopener">The proc/self/environ Injection</a></li>
</ol>
<h4 id="2-5-åŒ…å«fd"><a href="#2-5-åŒ…å«fd" class="headerlink" title="2.5 åŒ…å«fd"></a>2.5 åŒ…å«fd</h4><p>ä¸åŒ…å«environç±»ä¼¼ã€‚<br>å‚è€ƒï¼š</p>
<ol>
<li><a href="https://highon.coffee/blog/lfi-cheat-sheet/#procselffd-lfi-method" target="_blank" rel="noopener">LFI Cheat Sheetï¼š/proc/self/environ LFI Method</a></li>
</ol>
<h4 id="2-6-åŒ…å«ä¸´æ—¶æ–‡ä»¶"><a href="#2-6-åŒ…å«ä¸´æ—¶æ–‡ä»¶" class="headerlink" title="2.6 åŒ…å«ä¸´æ—¶æ–‡ä»¶"></a>2.6 åŒ…å«ä¸´æ—¶æ–‡ä»¶</h4><p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/16693166.jpg" alt=""></p>
<p>phpä¸­ä¸Šä¼ æ–‡ä»¶ï¼Œä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚åœ¨linuxä¸‹ä½¿ç”¨/tmpç›®å½•ï¼Œè€Œåœ¨windowsä¸‹ä½¿ç”¨c:\winsdows\tempç›®å½•ã€‚åœ¨ä¸´æ—¶æ–‡ä»¶è¢«åˆ é™¤ä¹‹å‰ï¼Œåˆ©ç”¨ç«äº‰å³å¯åŒ…å«è¯¥ä¸´æ—¶æ–‡ä»¶ã€‚</p>
<p>ç”±äºåŒ…å«éœ€è¦çŸ¥é“åŒ…å«çš„æ–‡ä»¶åã€‚ä¸€ç§æ–¹æ³•æ˜¯è¿›è¡Œæš´åŠ›çŒœè§£ï¼Œlinuxä¸‹ä½¿ç”¨çš„éšæœºå‡½æ•°æœ‰ç¼ºé™·ï¼Œè€Œwindowä¸‹åªæœ‰65535ä¸­ä¸åŒçš„æ–‡ä»¶åï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•æ˜¯å¯è¡Œçš„ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯é…åˆphpinfoé¡µé¢çš„php variablesï¼Œå¯ä»¥ç›´æ¥è·å–åˆ°ä¸Šä¼ æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„å’Œä¸´æ—¶æ–‡ä»¶åï¼Œç›´æ¥åŒ…å«å³å¯ã€‚å‚è€ƒï¼š<a href="https://www.insomniasec.com/downloads/publications/LFI%20With%20PHPInfo%20Assistance.pdf" target="_blank" rel="noopener">LFI WITH PHPINFO() ASSISTANCE</a></p>
<p>ç±»ä¼¼åˆ©ç”¨ä¸´æ—¶æ–‡ä»¶çš„å­˜åœ¨ï¼Œç«äº‰æ—¶é—´å»åŒ…å«çš„ï¼Œå‚è€ƒï¼š<a href="https://chybeta.github.io/2017/08/22/XMAN%E5%A4%8F%E4%BB%A4%E8%90%A5-2017-babyweb-writeup/" target="_blank" rel="noopener">XMANå¤ä»¤è¥-2017-babyweb-writeup</a></p>
<h4 id="2-7-åŒ…å«ä¸Šä¼ æ–‡ä»¶"><a href="#2-7-åŒ…å«ä¸Šä¼ æ–‡ä»¶" class="headerlink" title="2.7 åŒ…å«ä¸Šä¼ æ–‡ä»¶"></a>2.7 åŒ…å«ä¸Šä¼ æ–‡ä»¶</h4><p>åˆ©ç”¨æ¡ä»¶ï¼š</p>
<ol>
<li>è¿ä¹ä¹‹å¦™ï¼Œå­˜ä¹ä¸€å¿ƒã€‚çŸ¥é“ä¸Šä¼ æ–‡ä»¶åœ¨å“ªï¼Œå«å•¥ã€‚</li>
</ol>
<p>å§¿åŠ¿ï¼š<br>é…åˆä¸Šä¼ æ¼æ´ã€‚</p>
<h4 id="2-8-å…¶ä»–"><a href="#2-8-å…¶ä»–" class="headerlink" title="2.8 å…¶ä»–"></a>2.8 å…¶ä»–</h4><p>ä¸€ä¸ªwebæœåŠ¡å¾€å¾€ä¼šç”¨åˆ°å¤šä¸ªå…¶ä»–æœåŠ¡ï¼Œæ¯”å¦‚ftpæœåŠ¡ï¼Œæ•°æ®åº“ç­‰ç­‰ã€‚è¿™äº›åº”ç”¨ä¹Ÿä¼šäº§ç”Ÿç›¸åº”çš„æ–‡ä»¶ï¼Œä½†è¿™å°±éœ€è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æå’¯ã€‚è¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p>
<h3 id="3-ç»•è¿‡å§¿åŠ¿"><a href="#3-ç»•è¿‡å§¿åŠ¿" class="headerlink" title="3 ç»•è¿‡å§¿åŠ¿"></a>3 ç»•è¿‡å§¿åŠ¿</h3><p>æ¥ä¸‹æ¥èŠèŠç»•è¿‡å§¿åŠ¿ã€‚å¹³å¸¸ç¢°åˆ°çš„æƒ…å†µè‚¯å®šä¸ä¼šæ˜¯ç®€ç®€å•å•çš„include $_GET[â€˜fileâ€™];è¿™æ ·ç›´æ¥æŠŠå˜é‡ä¼ å…¥åŒ…å«å‡½æ•°çš„ã€‚åœ¨å¾ˆå¤šæ—¶å€™åŒ…å«çš„å˜é‡/æ–‡ä»¶ä¸æ˜¯å®Œå…¨å¯æ§çš„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç æŒ‡å®šäº†å‰ç¼€å’Œåç¼€ï¼š</p>
<h4 id="3-1-æŒ‡å®šå‰ç¼€"><a href="#3-1-æŒ‡å®šå‰ç¼€" class="headerlink" title="3.1 æŒ‡å®šå‰ç¼€"></a>3.1 æŒ‡å®šå‰ç¼€</h4><p>æµ‹è¯•ä»£ç ï¼š</p>
<h5 id="3-1-1-ç›®å½•éå†"><a href="#3-1-1-ç›®å½•éå†" class="headerlink" title="3.1.1 ç›®å½•éå†"></a>3.1.1 ç›®å½•éå†</h5><p>æµ‹è¯•ä»£ç ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/74648312.jpg" alt=""></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/82335497.jpg" alt=""></p>
<p>å¯ä»¥ä½¿ç”¨<code>../</code>è¿›è¡Œç›®å½•éå†ï¼š<br><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/43935551.jpg" alt=""></p>
<h5 id="3-1-2-ç¼–ç ç»•è¿‡"><a href="#3-1-2-ç¼–ç ç»•è¿‡" class="headerlink" title="3.1.2 ç¼–ç ç»•è¿‡"></a>3.1.2 ç¼–ç ç»•è¿‡</h5><p>æœåŠ¡å™¨ç«¯å¸¸å¸¸ä¼šå¯¹äº../ç­‰åšä¸€äº›è¿‡æ»¤ï¼Œå¯ä»¥ç”¨ä¸€äº›ç¼–ç æ¥è¿›è¡Œç»•è¿‡ã€‚ä¸‹é¢è¿™äº›æ€»ç»“æ¥è‡ªã€Šç™½å¸½å­è®²Webå®‰å…¨ã€‹ã€‚</p>
<ul>
<li>åˆ©ç”¨urlç¼–ç ï¼š<ul>
<li>../<ul>
<li>..%2f</li>
<li>%2e%2e%2f</li>
<li>%2e%2e/</li>
</ul>
</li>
<li>..\<ul>
<li>%2e%2e%5c</li>
<li>..%5c</li>
<li>%2e%2e\</li>
</ul>
</li>
</ul>
</li>
<li>äºŒæ¬¡ç¼–ç ,æœåŠ¡å™¨æœ‰å¯èƒ½è§£ç ä¸€æ¬¡<ul>
<li>../<ul>
<li>%252e%252e%252f</li>
</ul>
</li>
<li>..\<ul>
<li>%252e%252e%255c</li>
</ul>
</li>
</ul>
</li>
<li>å®¹å™¨/æœåŠ¡å™¨çš„ç¼–ç æ–¹å¼<ul>
<li>../<ul>
<li>..%c0%af<ul>
<li>æ³¨ï¼š</li>
</ul>
</li>
<li>%c0%ae%c0%ae/<ul>
<li>æ³¨ï¼šjavaä¸­ä¼šæŠŠâ€%c0%aeâ€è§£æä¸ºâ€\uC0AEâ€ï¼Œæœ€åè½¬ä¹‰ä¸ºASCCIIå­—ç¬¦çš„â€.â€ï¼ˆç‚¹ï¼‰</li>
<li>Apache Tomcat Directory Traversal</li>
</ul>
</li>
</ul>
</li>
<li>..\<ul>
<li>..%c1%9c</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-2-æŒ‡å®šåç¼€"><a href="#3-2-æŒ‡å®šåç¼€" class="headerlink" title="3.2 æŒ‡å®šåç¼€"></a>3.2 æŒ‡å®šåç¼€</h4><p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/30330703.jpg" alt=""></p>
<p><img src="http://myqwerimage.oss-cn-beijing.aliyuncs.com/18-2-3/53453971.jpg" alt=""></p>
<h5 id="3-2-1-URL"><a href="#3-2-1-URL" class="headerlink" title="3.2.1 URL"></a>3.2.1 URL</h5><p>urlæ ¼å¼ï¼š<br><code>protocol :// hostname[:port] / path / [;parameters][?query]#fragment</code><br>å§¿åŠ¿ä¸€ï¼š</p>
<h5 id="3-3-åˆ©ç”¨åè®®"><a href="#3-3-åˆ©ç”¨åè®®" class="headerlink" title="3.3 åˆ©ç”¨åè®®"></a>3.3 åˆ©ç”¨åè®®</h5><h5 id="3-3-1-é•¿åº¦æˆªæ–­"><a href="#3-3-1-é•¿åº¦æˆªæ–­" class="headerlink" title="3.3.1 é•¿åº¦æˆªæ–­"></a>3.3.1 é•¿åº¦æˆªæ–­</h5><h5 id="3-3-2-0å­—èŠ‚æˆªæ–­"><a href="#3-3-2-0å­—èŠ‚æˆªæ–­" class="headerlink" title="3.3.2 0å­—èŠ‚æˆªæ–­"></a>3.3.2 0å­—èŠ‚æˆªæ–­</h5><h3 id="4-é˜²å¾¡æ–¹æ¡ˆ"><a href="#4-é˜²å¾¡æ–¹æ¡ˆ" class="headerlink" title="4 é˜²å¾¡æ–¹æ¡ˆ"></a>4 é˜²å¾¡æ–¹æ¡ˆ</h3><h4 id="Refference"><a href="#Refference" class="headerlink" title="Refference"></a>Refference</h4>
    </div>
  </div>
  
    <div class="copy-right">
      <div class="markdown-body">
        <blockquote>
        
        
          æœ¬æ–‡ä½œè€… : leavky <br>
        
        åŸæ–‡é“¾æ¥ : <a href="">https://leavky.github.io/2019/01/16/PHPæ–‡ä»¶åŒ…å«æ¼æ´/</a><br>
        ç‰ˆæƒå£°æ˜ : æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
        </blockquote>
      </div>
    </div>
  
  
  
    <div class="social-share" style="margin-top: -2rem" data-wechat-qrcode-title="<p>å¾®ä¿¡æ‰«ä¸€æ‰«</p>" data-wechat-qrcode-helper="<p>å¾®ä¿¡å³ä¸Šè§’, æ‰«ä¸€æ‰«åˆ†äº«</p>" data-sites="qzone, qq, weibo, wechat, douban, google, facebook, twitter">
  <span style="color: #6b7487; font-size: 1.4rem;">åˆ†äº«åˆ°: </span>
</div>
<script src="https://cdn.bootcss.com/social-share.js/1.0.16/js/social-share.min.js" async></script>
  

  

  <div class="article-footer">
    <div class="article-meta pull-left">
      <span>
        
          <i class="iconfont icon-06tags"></i>æ ‡ç­¾: 
          
          <span class="span--tag">
            <a href="/leavky.github.io/tags/WEBå®‰å…¨/">
              #WEBå®‰å…¨
            </a>
          </span>
          
          <span class="span--tag">
            <a href="/leavky.github.io/tags/æ–‡ä»¶åŒ…å«/">
              #æ–‡ä»¶åŒ…å«
            </a>
          </span>
          
          <span class="span--tag">
            <a href="/leavky.github.io/tags/PHPæ–‡ä»¶åŒ…å«/">
              #PHPæ–‡ä»¶åŒ…å«
            </a>
          </span>
          
        
      </span>
    </div>
    <div class="article-meta pull-right">
    </div>
  </div>
</div>


  <aside id="sidebar">
    <p id="sidebar-header"></p>
    <ol id="sidebar-toc"></ol>
  </aside>
  <script async>setTimeout(generateToc, 10);</script>


  <nav class="post-navigation">
    
      <div class="nav-pre">
        <i class="iconfont icon-prev"></i>
        ä¸Šä¸€ç¯‡:
        <a href="/leavky.github.io/2019/01/16/nmapå°ç»“/" target="_self">Nmapå°ç»“</a>
      </div>
    
    
      <div class="nav-next">
        ä¸‹ä¸€ç¯‡:
        <a href="/leavky.github.io/2019/01/16/Powersploitä½¿ç”¨å°ç»“/" target="_self">Powersploitä½¿ç”¨å°ç»“</a>
        <i class="iconfont icon-next"></i>
      </div>
    
  </nav>

  
    <a href="#comment" class="comment-anchor"></a>
<div class="comment-title"><i class="iconfont icon-footprint"></i> ç•™ä¸‹è¶³è¿¹ <i class="iconfont icon-footprint"></i></div>
<div id="vcomments"></div>

<script defer>
  if( true ) {
    let path = getRealPath()
    new Valine({
      el: "#vcomments",
      appId: "jTCdtlhqGDp1dmfoL7X1CoNK-gzGzoHsz",
      appKey: "bEQmOmCRmRvcNNbMzWsyAO5Q",
      notify: false,
      verify: false,
      avatar: "robohash",
      placeholder: "æ­£ç¡®å¡«å†™é‚®ç®±, æ‰èƒ½åŠæ—¶æ”¶åˆ°å›å¤å“¦â™ª(^âˆ‡^*)",
      path
    });
  }
</script>
   

   

</div>


      <footer>
  <p class="site-info">
    åšå®¢å·²èŒèŒå“’è¿è¡Œ<span id="time-to-now"></span><span class="my-face">(â—'â—¡'â—)ï¾‰â™¥</span>
    <br>
    Theme - <a href="https://github.com/dongyuanxin/theme-bmw">BMW</a> | Made With ğŸ’— | Powered by <a href="https://godbmw.com/">GodBMW</a>
    <br>
    
  </p>
</footer>



<script>
const timeToNowDOM = document.querySelector("#time-to-now");
const startTimestamp = new Date(2018, 1, 10).getTime();

const updateTimeStr = () => {
  let offset = parseInt(
      (new Date().getTime() - startTimestamp) / 1000,
      10
    ),
    day = Math.floor(offset / 86400),
    hour = Math.floor((offset % 86400) / 3600),
    minute = Math.floor(((offset % 86400) % 3600) / 60),
    second = Math.floor(((offset % 86400) % 3600) % 60);
  timeToNowDOM.innerHTML =
    day + "å¤©" + hour + "å°æ—¶" + minute + "åˆ†é’Ÿ" + second + "ç§’";
  setTimeout(updateTimeStr, 500);
}

setTimeout(updateTimeStr, 500);
</script>


      <div class="back-to-top hidden">
  <span>
    <i class="iconfont icon-60"></i><span></span>%
  </span>
</div>

<script>
const updateIconToTop = percent => {
  let dom = document.querySelector(".back-to-top span span");
  dom.innerText = percent;
  if(percent < 1) {
    document.querySelector(".back-to-top").className = "back-to-top hidden";
  } else {
    document.querySelector(".back-to-top").className = "back-to-top";
  }
}

const handleScoll = () => {
  let isRunning = false;
  return () => {
    if (isRunning) return;
    isRunning = true;
    window.requestAnimationFrame(timestamp => {
      let scrollTop =
          document.documentElement.scrollTop || document.body.scrollTop,
        scrollHeight =
          document.documentElement.scrollHeight ||
          document.body.scrollHeight,
        clientHeight =
          document.documentElement.clientHeight ||
          document.body.clientHeight;
      isRunning = false;
      if (scrollTop <= 1) {
        updateIconToTop(0);
        return;
      }
      if (scrollTop + clientHeight >= scrollHeight) {
        updateIconToTop(100);
      } else {
        updateIconToTop(parseInt(
          100 * scrollTop / (scrollHeight - clientHeight),
          10
        ));
      }
    });
  };
}

const backToTop = () => {
  let scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop,
    delay = 10,
    time = 200;
  if (scrollTop <= 20) {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;
    return;
  }
  let step = Math.ceil(scrollTop * delay / time);
  let timer = setInterval(() => {
    scrollTop =
      document.documentElement.scrollTop || document.body.scrollTop;
    if (scrollTop - step <= 0) {
      document.documentElement.scrollTop = 0;
      document.body.scrollTop = 0;
      clearInterval(timer);
    } else {
      document.documentElement.scrollTop = scrollTop - step;
      document.body.scrollTop = scrollTop - step;
    }
  }, delay);
}

document.addEventListener("scroll", handleScoll(), false);

document.querySelector(".back-to-top").addEventListener("click", backToTop, false);

</script>

    </div>

    
      <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
<script>
  (() => {
    const mathjaxConfig = {
      showProcessingMessages: false, //å…³é—­jsåŠ è½½è¿‡ç¨‹ä¿¡æ¯
      messageStyle: "none", //ä¸æ˜¾ç¤ºä¿¡æ¯
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]], //è¡Œå†…å…¬å¼é€‰æ‹©ç¬¦
        displayMath: [["$$", "$$"], ["\\[", "\\]"]], //æ®µå†…å…¬å¼é€‰æ‹©ç¬¦
        skipTags: ["script", "noscript", "style", "textarea", "pre", "code", "a"] //é¿å¼€æŸäº›æ ‡ç­¾
      },
      "HTML-CSS": {
        availableFonts: ["STIX", "TeX"], //å¯é€‰å­—ä½“
        showMathMenu: false //å…³é—­å³å‡»èœå•æ˜¾ç¤º
      }
    }

    let mathjaxInterval = setInterval(() => {
      if(!window.MathJax){
        return;
      }
      window.MathJax.Hub.Config(mathjaxConfig)
      window.MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.getElementById('app')])

      clearInterval(mathjaxInterval)
    }, 10)    
  })()
</script>
    

    <script src="https://cdn.bootcss.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script>
<script async>
  let fancyTimer = setInterval(function(){
    if(!window.$){
      return;
    }
    $(document).ready(function() {
      $(".post img").each(function () {
        if($(this).parent().get(0).tagName.toLowerCase() === "a") {
          return;
        }
        // $(this).attr("data-fancybox", "gallery"); // if you add 'data-fancybox', img will display after showed
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "gallery");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      });
      
      clearInterval(fancyTimer);
    });
  }, 10);
</script>

    
  </body>

</html>
